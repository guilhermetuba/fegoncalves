<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <title>Contas a Receber</title>
 <link rel="stylesheet" href="estilos.css">
</head>
<body>
    <div class="container">
        <a href="index.html" class="link-button">Voltar para o Início</a>
        <h2>Contas a Receber</h2>
        <label for="filtro">Filtrar por situação:</label>
  <select id="filtro" onchange="aplicarFiltro()">
    <option value="todas">Todas</option>
    <option value="atrasadas">Atrasadas</option>
    <option value="30">A vencer em até 30 dias</option>
    <option value="60">A vencer em até 60 dias</option>
    <option value="90">A vencer em 90 dias ou mais</option>
  </select>

    



    <div id="carrinhoContainer" style="display: none;">
  <h3 id="tituloCarrinho">Produtos no Condi</h3>
  <div class="tabela-wrapper">
  <table id="tabelaCarrinho">
    <thead>
      <tr>
        <th>Cliente</th>
        <th>CPF</th>
        <th>Valor</th>
        <th>Vencimento</th>
        <th></th>
      </tr>
    </thead>
    <tbody></tbody>
  </table>
  </div>
</div>

    <hr>
    <label for="total">Total: <span id="total">R$ 0,00</span></label>
    <br>

      </div>
  <a href="index.html" class="link-button">Voltar para o Início</a>

  <script>
    let contas = [];

    async function carregarDados() {
      try {
        // Substituir quando API estiver pronta
        // const response = await fetch('https://seu-backend/api/contas');
        // contas = await response.json();

        // MOCK de dados para simulação
        contas = [
          { cpf: '12345678900', valor: 150, vencimento: '2025-05-05', status: 'Em aberto' },
          { cpf: '11122233344', valor: 300, vencimento: '2025-06-01', status: 'Em aberto' },
          { cpf: '55566677788', valor: 450, vencimento: '2025-03-15', status: 'Pago' },
          { cpf: '12345678900', valor: 200, vencimento: '2025-06-20', status: 'Em aberto' },
        ];

        contas = contas.filter(c => c.status === 'Em aberto');

        for (let c of contas) {
          c.nome = await buscarNomeCliente(c.cpf);
        }

        aplicarFiltro();
      } catch (error) {
        alert('Erro ao carregar dados: ' + error);
      }
    }

    async function buscarNomeCliente(cpf) {
      try {
        const response = await fetch(`https://meu-backend-xi.vercel.app/api/consulta_cliente?cpf=${cpf}`);
        const dados = await response.json();
        return dados.nome || 'Cliente não encontrado';
      } catch (error) {
        return 'Erro na consulta';
      }
    }

    function aplicarFiltro() {
      const filtro = document.getElementById('filtro').value;
      const hoje = new Date();
      const corpo = document.querySelector('#tabelaContas tbody');
      corpo.innerHTML = '';
      let total = 0;

      contas.forEach(conta => {
        const venc = new Date(conta.vencimento);
        const dias = Math.ceil((venc - hoje) / (1000 * 60 * 60 * 24));

        let incluir = false;
        if (filtro === 'todas') incluir = true;
        else if (filtro === 'atrasadas' && dias < 0) incluir = true;
        else if (filtro === '30' && dias >= 0 && dias <= 30) incluir = true;
        else if (filtro === '60' && dias > 30 && dias <= 60) incluir = true;
        else if (filtro === '90' && dias > 60) incluir = true;

        if (incluir) {
          const linha = document.createElement('tr');
          linha.innerHTML = `
            <td>${conta.nome}</td>
            <td>${conta.cpf}</td>
            <td>R$ ${conta.valor.toFixed(2)}</td>
            <td>${new Date(conta.vencimento).toLocaleDateString()}</td>
          `;
          corpo.appendChild(linha);
          total += conta.valor;
        }
      });

      document.getElementById('total').textContent = `R$ ${total.toFixed(2)}`;
    }

    carregarDados();
  </script>
</body>
</html>
